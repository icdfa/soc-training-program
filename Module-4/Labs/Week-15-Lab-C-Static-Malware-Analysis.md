# Week 15 Lab C: Static Malware Analysis

## Learning Outcomes

By the end of this lab, you will be able to:

- Perform static analysis on a malware sample using a variety of tools.
- Identify key characteristics of a malware sample without executing it.
- Extract Indicators of Compromise (IOCs) from a malware sample.
- Document and report on the findings of a static malware analysis investigation.

## 1. Objective

In this lab, you will perform static analysis on a malware sample without executing it. Static analysis involves examining the malware's code, strings, and structure to understand its functionality and behavior.

## 2. Prerequisites

- A FlareVM environment (from Lab B)
- A malware sample (WannaCry or similar)
- Basic understanding of Windows PE file format

## 3. Tools Used

- **PEStudio**: PE file analysis tool
- **Strings**: Extract printable strings from binary files
- **PEiD**: Detect packers and compilers
- **Dependency Walker**: Analyze DLL dependencies
- **IDA Free**: Disassembler for reverse engineering

## 4. Lab Steps

### Step 1: Obtain the Malware Sample

Download the WannaCry ransomware sample from MalwareBazaar or theZoo repository. Extract it using the password "infected" in your isolated FlareVM environment.

### Step 2: Calculate File Hashes

Calculate the MD5, SHA1, and SHA256 hashes of the malware sample using the following PowerShell command:

```powershell
Get-FileHash -Algorithm MD5 wannacry.exe
Get-FileHash -Algorithm SHA1 wannacry.exe
Get-FileHash -Algorithm SHA256 wannacry.exe
```

### Step 3: Analyze with PEStudio

Open the malware sample in PEStudio and examine the following:

- **File Header**: Check the file type, architecture, and compilation timestamp.
- **Imports**: Identify the DLLs and functions imported by the malware.
- **Strings**: Look for suspicious strings, URLs, IP addresses, and file paths.
- **Resources**: Check for embedded files, icons, or other resources.
- **Indicators**: Review the indicators of compromise (IoCs) identified by PEStudio.

### Step 4: Extract Strings

Use the Strings tool to extract all printable strings from the malware sample:

```cmd
strings wannacry.exe > wannacry_strings.txt
```

Review the output file and look for:
- URLs and IP addresses
- File paths
- Registry keys
- Error messages
- Encryption keys or passwords

### Step 5: Identify Packers

Use PEiD to detect if the malware is packed or obfuscated. Packed malware is compressed or encrypted to evade detection.

### Step 6: Analyze DLL Dependencies

Use Dependency Walker to identify the DLLs and functions that the malware depends on. This can provide clues about the malware's functionality.

### Step 7: Disassemble with IDA Free

Open the malware sample in IDA Free and examine the disassembled code. Look for:
- Entry point
- Suspicious function calls (e.g., CreateFile, WriteFile, RegSetValue)
- Network communication functions (e.g., socket, connect, send)
- Encryption or encoding routines

## 5. Analysis Questions

Answer the following questions based on your static analysis:

1. What is the SHA256 hash of the malware sample?
2. What is the compilation timestamp of the malware?
3. What suspicious strings did you find in the malware?
4. Is the malware packed? If so, what packer was used?
5. What DLLs and functions does the malware import?
6. What is the entry point of the malware?
7. What indicators of compromise (IoCs) did you identify?

## 6. Deliverables

- A written report documenting your static analysis findings.
- Screenshots of PEStudio, Strings output, and IDA disassembly.
- A list of IoCs (hashes, IPs, URLs, file paths, registry keys).

## 7. Additional Resources

- [PEStudio User Guide](https://www.winitor.com/download)
- [Strings Documentation](https://docs.microsoft.com/en-us/sysinternals/downloads/strings)
- [IDA Free Download](https://hex-rays.com/ida-free/)
