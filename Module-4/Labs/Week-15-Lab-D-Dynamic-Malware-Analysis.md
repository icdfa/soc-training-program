# Week 15 Lab D: Dynamic Malware Analysis

## Learning Outcomes

By the end of this lab, you will be able to:

- Perform dynamic analysis on a malware sample in a controlled environment.
- Use tools like Process Monitor, Process Explorer, Wireshark, and Regshot to observe malware behavior.
- Identify file system, registry, network, and process activity associated with a malware sample.
- Document and report on the findings of a dynamic malware analysis investigation.

## 1. Objective

In this lab, you will perform dynamic analysis on a malware sample by executing it in a controlled environment and observing its behavior. Dynamic analysis allows you to see what the malware actually does when it runs.

## 2. Prerequisites

- A FlareVM environment (from Lab B)
- A malware sample (WannaCry or similar)
- Process Monitor (ProcMon)
- Process Explorer
- Wireshark
- Regshot

## 3. Safety Precautions

**CRITICAL:** Before executing malware, ensure that:
- Your VM is completely isolated from the network (disable network adapter or use host-only networking).
- You have taken a clean snapshot of your VM.
- You are prepared to revert to the snapshot after analysis.

## 4. Lab Steps

### Step 1: Prepare the Environment

1. Take a snapshot of your clean FlareVM.
2. Disable the network adapter or configure host-only networking.
3. Start Process Monitor (ProcMon) and configure filters.
4. Start Wireshark to capture network traffic (if using host-only networking).
5. Take a "before" snapshot using Regshot to capture the initial registry state.

### Step 2: Execute the Malware

1. Copy the malware sample to your FlareVM desktop.
2. Double-click the malware to execute it.
3. Observe the behavior in real-time using Process Monitor and Process Explorer.

### Step 3: Monitor File System Activity

Use Process Monitor to observe:
- Files created, modified, or deleted by the malware.
- File paths and names.
- Suspicious file operations (e.g., creating files in system directories).

### Step 4: Monitor Registry Activity

Use Process Monitor to observe:
- Registry keys created, modified, or deleted by the malware.
- Persistence mechanisms (e.g., Run keys, scheduled tasks).
- Configuration changes.

### Step 5: Monitor Network Activity

Use Wireshark to observe:
- Network connections initiated by the malware.
- IP addresses and ports contacted.
- Protocols used (HTTP, HTTPS, DNS, etc.).
- Data transmitted or received.

### Step 6: Monitor Process Activity

Use Process Explorer to observe:
- New processes created by the malware.
- Process injection or code injection.
- DLLs loaded by the malware.
- CPU and memory usage.

### Step 7: Take "After" Snapshot

Use Regshot to take an "after" snapshot of the registry and compare it with the "before" snapshot to identify all registry changes made by the malware.

### Step 8: Clean Up

1. Stop all monitoring tools.
2. Save all captured data (ProcMon logs, Wireshark captures, Regshot comparison).
3. Revert your VM to the clean snapshot.

## 5. Analysis Questions

Answer the following questions based on your dynamic analysis:

1. What files did the malware create or modify?
2. What registry keys did the malware create or modify?
3. What network connections did the malware attempt to establish?
4. What processes did the malware create?
5. What persistence mechanisms did the malware use?
6. What is the overall behavior of the malware (e.g., ransomware, trojan, worm)?

## 6. Deliverables

- A written report documenting your dynamic analysis findings.
- Screenshots of Process Monitor, Process Explorer, and Wireshark.
- Regshot comparison report.
- A timeline of the malware's behavior.

## 7. Additional Resources

- [Process Monitor User Guide](https://docs.microsoft.com/en-us/sysinternals/downloads/procmon)
- [Process Explorer User Guide](https://docs.microsoft.com/en-us/sysinternals/downloads/process-explorer)
- [Wireshark User Guide](https://www.wireshark.org/docs/)
- [Regshot Download](https://sourceforge.net/projects/regshot/)
